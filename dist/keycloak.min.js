!function(e){var r=function(t){function n(){return k.authServerUrl+"/realms/"+encodeURIComponent(k.realm)}function o(e,r){var t=e.code,o=e.error,a=e.prompt;if(t){var s="code="+t,i=n()+"/tokens/access/codes",l=new XMLHttpRequest;l.open("POST",i,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),k.clientId&&k.clientSecret?l.setRequestHeader("Authorization","Basic "+btoa(k.clientId+":"+k.clientSecret)):s+="&client_id="+encodeURIComponent(k.clientId),l.withCredentials=!0,l.onreadystatechange=function(){if(4==l.readyState)if(200==l.status){var e=JSON.parse(l.responseText);c(e.access_token,e.refresh_token),k.onAuthSuccess&&k.onAuthSuccess(),r&&r.setSuccess()}else k.onAuthError&&k.onAuthError(),r&&r.setError()},l.send(s)}else o&&("none"!=a?(k.onAuthError&&k.onAuthError(),r&&r.setError()):r&&r.setSuccess())}function a(){var e,r=d();if(t?"string"==typeof t&&(e=t):e="keycloak.json",e){var n=new XMLHttpRequest;n.open("GET",e,!0),n.setRequestHeader("Accept","application/json"),n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status){var e=JSON.parse(n.responseText);k.authServerUrl=e["auth-server-url"],k.realm=e.realm,k.clientId=e.resource,k.clientSecret=(e.credentials||{}).secret,r.setSuccess()}else r.setError()},n.send()}else{if(!t.url)for(var o=document.getElementsByTagName("script"),a=0;a<o.length;a++)if(o[a].src.match(/.*keycloak\.js/)){t.url=o[a].src.substr(0,o[a].src.indexOf("/js/keycloak.js"));break}if(!t.realm)throw"realm missing";if(!t.clientId)throw"clientId missing";k.authServerUrl=t.url,k.realm=t.realm,k.clientId=t.clientId,k.clientSecret=(t.credentials||{}).secret,r.setSuccess()}return r.promise}function s(){k.token&&(c(null,null),k.onAuthLogout&&k.onAuthLogout(),k.loginRequired&&k.login())}function c(r,t){if((r||t)&&f(),r){k.token=r,k.tokenParsed=JSON.parse(decodeURIComponent(escape(e.atob(r.split(".")[1]))));var n=k.realm+"/"+k.tokenParsed.sub;k.tokenParsed.session_state&&(n=n+"/"+k.tokenParsed.session_state),k.sessionId=n,k.authenticated=!0,k.subject=k.tokenParsed.sub,k.realmAccess=k.tokenParsed.realm_access,k.resourceAccess=k.tokenParsed.resource_access;for(var o=0;o<g.length;o++){var a=g[o];k.tokenParsed[a]&&(k.idToken||(k.idToken={}),k.idToken[a]=k.tokenParsed[a])}}else delete k.token,delete k.tokenParsed,delete k.subject,delete k.realmAccess,delete k.resourceAccess,delete k.idToken,k.authenticated=!1;t?(k.refreshToken=t,k.refreshTokenParsed=JSON.parse(atob(t.split(".")[1]))):(delete k.refreshToken,delete k.refreshTokenParsed)}function i(){for(var e=[],r="0123456789abcdef",t=0;36>t;t++)e[t]=r.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=r.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n}function l(){var e="<id: "+k.callback_id++ +Math.random()+">";return e}function u(e){if(-1!=e.indexOf("?")){for(var r={},t=e.split("?")[1].split("&"),n=0;n<t.length;n++){var o=t[n].split("=");switch(decodeURIComponent(o[0])){case"code":r.code=o[1];break;case"error":r.error=o[1];break;case"state":r.state=decodeURIComponent(o[1]);break;case"redirect_fragment":r.fragment=decodeURIComponent(o[1]);break;case"prompt":r.prompt=o[1]}}if((r.code||r.error)&&r.state&&r.state==sessionStorage.oauthState)return delete sessionStorage.oauthState,r}}function d(){var e={setSuccess:function(r){e.success=!0,e.result=r,e.successCallback&&e.successCallback(r)},setError:function(r){e.error=!0,e.result=r,e.errorCallback&&e.errorCallback(r)},promise:{success:function(r){return e.success?r(e.result):e.error||(e.successCallback=r),e.promise},error:function(r){return e.error?r(e.result):e.success||(e.errorCallback=r),e.promise}}};return e}function f(){if(v.enable&&!v.iframe){var r=document.createElement("iframe");r.onload=function(){var t=n();v.iframeOrigin="/"===t.charAt(0)?e.location.origin:t.substring(0,t.indexOf("/",8)),v.iframe=r};var t=n()+"/login-status-iframe.html?client_id="+encodeURIComponent(k.clientId)+"&origin="+e.location.origin;r.setAttribute("src",t),r.style.display="none",document.body.appendChild(r);var o=function(e){if(e.origin===v.iframeOrigin){var r=e.data,t=v.callbackMap[r.callbackId];delete v.callbackMap[r.callbackId],k.sessionId==r.session&&r.loggedIn?t.setSuccess():(s(),t.setError())}};e.addEventListener("message",o,!1);var a=function(){p(),k.token&&setTimeout(a,1e3*v.interval)};setTimeout(a,1e3*v.interval)}}function p(){var e=d();if(v.iframe||v.iframeOrigin){var r={};r.callbackId=l(),v.callbackMap[r.callbackId]=e;var t=v.iframeOrigin;v.iframe.contentWindow.postMessage(r,t)}else e.setSuccess();return e.promise}function m(r){if(!r||"default"==r)return{login:function(r){e.location.href=k.createLoginUrl(r)},logout:function(r){e.location.href=k.createLogoutUrl(r)},accountManagement:function(){e.location.href=k.createAccountUrl()},redirectUri:function(e){if(e&&e.redirectUri)return e.redirectUri;if(k.redirectUri)return k.redirectUri;var r=location.protocol+"//"+location.hostname+(location.port&&":"+location.port)+location.pathname;return location.hash&&(r+="?redirect_fragment="+encodeURIComponent(location.hash.substring(1))),r}};if("cordova"==r)return v.enable=!1,{login:function(r){var t=d(),n="location=no";r&&"none"==r.prompt&&(n+=",hidden=yes");var a,s,c=k.createLoginUrl(r),i=e.open(c,"_blank",n);return i.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&(a=u(e.url),i.close())}),i.addEventListener("loaderror",function(e){0!=e.url.indexOf("http://localhost")&&(s=!0,i.close())}),i.addEventListener("exit",function(){s||!a?t.setError():o(a,t)}),t.promise},logout:function(r){var t,n=d(),o=k.createLogoutUrl(r),a=e.open(o,"_blank","location=no,hidden=yes");return a.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&a.close()}),a.addEventListener("loaderror",function(e){0!=e.url.indexOf("http://localhost")&&(t=!0,a.close())}),a.addEventListener("exit",function(){t?n.setError():(s(),n.setSuccess())}),n.promise},accountManagement:function(){var r=k.createAccountUrl(),t=e.open(r,"_blank","location=no");t.addEventListener("loadstart",function(e){0==e.url.indexOf("http://localhost")&&t.close()})},redirectUri:function(){return"http://localhost"}};throw"invalid adapter type: "+r}if(!(this instanceof r))return new r(t);var h,k=this,v={enable:!0,callbackMap:[],interval:5};k.init=function(r){function n(){var t=u(e.location.href);if(t)return e.history.replaceState({},null,location.protocol+"//"+location.host+location.pathname+(t.fragment?"#"+t.fragment:"")),void o(t,i);if(r){if(r.token||r.refreshToken)c(r.token,r.refreshToken),i.setSuccess();else if(r.onLoad){var n={};switch(r.onLoad){case"check-sso":n.prompt="none";case"login-required":var a=k.login(n);a&&a.success(function(){i.setSuccess()}).error(function(){i.setError()});break;default:throw"Invalid value for onLoad"}}}else i.setSuccess()}k.authenticated=!1,h=e.Cordova?m("cordova"):m(),r&&("undefined"!=typeof r.checkLoginIframe&&(v.enable=r.checkLoginIframe),r.checkLoginIframeInterval&&(v.interval=r.checkLoginIframeInterval),"login-required"===r.onLoad&&(k.loginRequired=!0));var s=d(),i=d();i.promise.success(function(){k.onReady&&k.onReady(k.authenticated),s.setSuccess(k.authenticated)}).error(function(){s.setError()});var l=a(t);return l.success(n),l.error(function(){s.setError()}),s.promise},k.login=function(e){return h.login(e)},k.createLoginUrl=function(e){var r=i(),t=h.redirectUri(e);e&&e.prompt&&(t+=-1==t.indexOf("?")?"?prompt="+e.prompt:"&prompt="+e.prompt),sessionStorage.oauthState=r;var o=n()+"/tokens/login?client_id="+encodeURIComponent(k.clientId)+"&redirect_uri="+encodeURIComponent(t)+"&state="+encodeURIComponent(r)+"&response_type=code";return e&&e.prompt&&(o+="&prompt="+e.prompt),o},k.logout=function(e){return h.logout(e)},k.createLogoutUrl=function(e){var r=n()+"/tokens/logout?redirect_uri="+encodeURIComponent(h.redirectUri(e));return r},k.createAccountUrl=function(e){var r=n()+"/account?referrer="+encodeURIComponent(k.clientId)+"&referrer_uri="+encodeURIComponent(h.redirectUri(e));return r},k.accountManagement=function(){return h.accountManagement()},k.hasRealmRole=function(e){var r=k.realmAccess;return!!r&&r.roles.indexOf(e)>=0},k.hasResourceRole=function(e,r){if(!k.resourceAccess)return!1;var t=k.resourceAccess[r||k.clientId];return!!t&&t.roles.indexOf(e)>=0},k.loadUserProfile=function(){var e=n()+"/account",r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+k.token);var t=d();return r.onreadystatechange=function(){4==r.readyState&&(200==r.status?(k.profile=JSON.parse(r.responseText),t.setSuccess(k.profile)):t.setError())},r.send(),t.promise},k.isTokenExpired=function(e){if(!k.tokenParsed||!k.refreshToken)throw"Not authenticated";var r=k.tokenParsed.exp-(new Date).getTime()/1e3;return e&&(r-=e),0>r},k.updateToken=function(e){var r=d();if(!k.tokenParsed||!k.refreshToken)return r.setError(),r.promise;e=e||5;var t=function(){if(k.isTokenExpired(e)){var t="grant_type=refresh_token&refresh_token="+k.refreshToken,o=n()+"/tokens/refresh",a=new XMLHttpRequest;a.open("POST",o,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),k.clientId&&k.clientSecret?a.setRequestHeader("Authorization","Basic "+btoa(k.clientId+":"+k.clientSecret)):t+="&client_id="+encodeURIComponent(k.clientId),a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status){var e=JSON.parse(a.responseText);c(e.access_token,e.refresh_token),k.onAuthRefreshSuccess&&k.onAuthRefreshSuccess(),r.setSuccess(!0)}else k.onAuthRefreshError&&k.onAuthRefreshError(),r.setError()},a.send(t)}else r.setSuccess(!1)};if(v.enable){var o=p();o.success(function(){t()}).error(function(){r.setError()})}else t();return r.promise},k.callback_id=0;var g=["name","given_name","family_name","middle_name","nickname","preferred_username","profile","picture","website","email","email_verified","gender","birthdate","zoneinfo","locale","phone_number","phone_number_verified","address","updated_at","formatted","street_address","locality","region","postal_code","country","claims_locales"]};"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=r:(e.Keycloak=r,"function"==typeof define&&define.amd&&define("keycloak",[],function(){return r}))}(window);
//# sourceMappingURL=keycloak.min.js.map